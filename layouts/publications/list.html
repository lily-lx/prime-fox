{{- define "main" -}}

{{/* 加载CSS文件 */}}
<link rel="stylesheet" href="{{ "css/publications.css" | relURL }}">

<div class="container publications-container">
  {{/* 页面标题 */}}
  <div class="publications-header">
    <h1>{{ .Title }}</h1>
    <div class="publication-stats">
      <span class="stat-badge">{{ len .Pages }} publications</span>
      <span class="stat-badge" id="filtered-count">{{ len .Pages }} shown</span>
    </div>
  </div>
  
  {{/* 顶部筛选栏 */}}
  <div class="publications-filters">
    <div class="filter-row">
      {{/* 年份筛选 */}}
      {{ $years := slice }}
      {{ range .Pages }}
        {{ if .Date }}
          {{ $years = $years | append (.Date.Format "2006") }}
        {{ end }}
      {{ end }}
      {{ $years = $years | uniq | sort }}
      {{ $years = sort $years "value" "desc" }}
      
      <div class="filter-group">
        <span class="filter-label">Year:</span>
        <button class="filter-btn active" data-year="all">All</button>
        {{ range $years }}
        <button class="filter-btn" data-year="{{ . }}">{{ . }}</button>
        {{ end }}
      </div>
      
      {{/* 类型筛选 */}}
      <div class="filter-group">
        <span class="filter-label">Type:</span>
        <button class="filter-btn active" data-type="all">All</button>
        <button class="filter-btn" data-type="1">Conference</button>
        <button class="filter-btn" data-type="2">Journal</button>
      </div>
    </div>
    
    {{/* 搜索框 */}}
    <div class="search-box">
      <input type="text" id="publication-search" class="search-input" placeholder="Search publications...">
      <button id="clear-filters" class="btn-clear">Clear All</button>
    </div>
  </div>
  
  {{/* 论文列表 */}}
  <div id="publications-container">
    {{ $sortedPages := sort .Pages "Date" "desc" }}
    {{ range $sortedPages }}
    <div class="publication-card" 
         data-year="{{ .Date.Format "2006" }}"
         data-type="{{ with .Params.publication_types }}{{ index . 0 }}{{ else }}unknown{{ end }}">
      
      {{/* 徽章 */}}
      <div class="publication-badges">
        {{ with .Params.publication_types }}
          {{ if eq (index . 0) "1" }}
          <span class="badge badge-conference">Conference</span>
          {{ else if eq (index . 0) "2" }}
          <span class="badge badge-journal">Journal</span>
          {{ end }}
        {{ end }}
        
        {{ with .Params.publication_short }}
        <span class="badge badge-venue">{{ . }}</span>
        {{ end }}
        
        {{ with .Date }}
        <span class="badge badge-year">{{ .Format "2006" }}</span>
        {{ end }}
      </div>
      
      {{/* 标题 */}}
      <h3 class="publication-title">
        {{ if .Params.url_pdf }}
        <a href="{{ .Params.url_pdf }}" target="_blank">{{ .Title }}</a>
        {{ else if .Params.doi }}
        <a href="https://doi.org/{{ .Params.doi }}" target="_blank">{{ .Title }}</a>
        {{ else }}
        {{ .Title }}
        {{ end }}
      </h3>
      
      {{/* 作者 */}}
      <div class="publication-authors">
        {{ with .Params.authors }}
          {{ $authorCount := len . }}
          {{ range $index, $author := . }}
            {{ if eq $author "Lingxi Xie" }}
              <strong class="author-self">{{ $author }}</strong>
            {{ else }}
              <span class="author-other">{{ $author }}</span>
            {{ end }}
            {{ if lt (add $index 1) $authorCount }}, {{ end }}
          {{ end }}
        {{ else }}
          {{ .Params.author }}
        {{ end }}
      </div>
      
      {{/* 会议/期刊信息 */}}
      <div class="publication-venue">
        {{ with .Params.publication }}
        {{ . }}
        {{ end }}
        {{ with .Params.publication_short }}
        ({{ . }})
        {{ end }}
      </div>
      
      {{/* 链接 */}}
      <div class="publication-links">
        {{ with .Params.url_pdf }}
        <a href="{{ . }}" class="link-btn" target="_blank">
          <i class="fas fa-file-pdf"></i> PDF
        </a>
        {{ end }}
        
        {{ with .Params.doi }}
        <a href="https://doi.org/{{ . }}" class="link-btn" target="_blank">
          <i class="fas fa-external-link-alt"></i> DOI
        </a>
        {{ end }}
        
        {{ with .Params.url_code }}
        <a href="{{ . }}" class="link-btn" target="_blank">
          <i class="fas fa-code"></i> Code
        </a>
        {{ end }}
      </div>
      
    </div>
    {{ end }}
  </div>
  
  {{/* 无结果提示 */}}
  <div id="no-results-message" class="no-results" style="display: none;">
    <h3>No publications found</h3>
    <p>Try adjusting your filters or search terms.</p>
  </div>
</div>

{{/* 加载JS文件 */}}
<script src="{{ "js/publications.js" | relURL }}" defer></script>

{{- end -}}
